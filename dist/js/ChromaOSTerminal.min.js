!function(a){"use strict";a.module("ChromaOSTerminal.Kernel",[]).constant("$",$)}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Services",[])}(window.angular),function(a){"use strict";function b(b){function c(a){var b=a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(a,b){return 0===b?a.toLowerCase():a.toUpperCase()}).replace(/\s+/g,"").replace(/-/g,"");return b=b.charAt(0).toLowerCase()+b.slice(1)}function d(a){var b;return b=!a||a&&a.result===!1&&!a.error?["err"]:a&&!a.result&&a.error?[a.error]:a}var e=function(a,b,c){var d,e=a.parameters.findIndex(function(a){return d=a.options.findIndex(function(a){return a.option===b&&(c&&b.length>1||!c&&1===b.length)}),d!==-1});return e!==-1&&{parameter:a.parameters[e],specific:a.parameters[e].options[d]}},f=function(f,g){for(var h,i=b.defer(),j=!1,k=0,l=g.split(" "),m=[];!j&&k<f.length;){var n=a.copy(f[k]);if(n.command===l[0]){if(j=!0,l.length>1)for(var o=1;o<l.length;o++){var p,q,r=l[o];if("--"===r.substring(0,2))if(r=r.substring(2),p=e(n,r,!0),q=!1,p){if(p.specific.params.length>0)if(o+p.specific.params.length<l.length)for(var s=0;s<p.specific.params.length;s++)h=c(p.specific.params[s]),n[h]=l[o+s+1];else i.resolve(["Param --"+r+" needs a value."]);h=c(l[o]),n[h]=!0}else i.resolve(["--"+r+": Parameter not found."]);else if("-"===r.substring(0,1)){r=r.substring(1);for(var t=0;t<r.length;t++)if(p=e(n,r[t],!1),q=!1,p){if(p.specific.params.length>0)if(o+p.specific.params.length<l.length)for(var u=0;u<p.specific.params.length;u++)h=c(p.specific.params[u]),n[h]=l[o+u+1];else i.resolve(["Param --"+r[t]+" needs a value."]);h=c(l[o]),n[h]=!0}else i.resolve(["-"+r[t]+": Parameter not found."])}}n.execute(m).then(function(a){i.resolve(d(a))})}k++}return j||i.resolve([l[0]+": Command not found."]),i.promise},g={parse:f};return g}a.module("ChromaOSTerminal.Services").factory("ChromaOSTerminalCommandsService",b),b.$inject=["$q"]}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules",["ChromaOSTerminal.Modules.Commands","ChromaOSTerminal.Modules.Terminal"])}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Commands.Command",[])}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Commands.Command").factory("ChromaOSTerminalBaseCommand",["ChromaOSTerminalParameter","$q",function(a,b){var c=function(b,c,d,e){this.name=b,this.description=c,this.command=d,this.action=e,this.parameters=[],this.addParameter(new a(["h","help"],"Help"))};return c.prototype.addParameter=function(a){this.parameters.push(a)},c.prototype.execute=function(a){var c,d=b.defer();if(this.h||this.help){for(var e=0;e<this.parameters.length;e++){for(var f=this.parameters[e],g=[],h=0;h<f.options.length;h++){var i=f.options[h];c=(i.option.length>1?"-":"")+"-"+i.option,i.params.length>0&&i.params.map(function(a){c+=" <"+a+">"}),g.push(c)}var j=g.join(", ");a.push(j+": "+f.description)}d.resolve(a)}else this.action(this,a).then(function(a){d.resolve(a)});return d.promise},c}])}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Commands.Command").factory("ChromaOSTerminalCommand",["ChromaOSTerminalBaseCommand",function(a,b){var c=function(){a.apply(this,arguments)};return c.prototype=new a,c}])}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Commands.Parameter",[])}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Commands.Parameter").factory("ChromaOSTerminalBaseParameter",function(){var a=function(a,b,c){this.options=a||[],this.options=this.options.map(function(a){for(var c=[],d=a.match(/<[a-z\-]+>/g),e=d?d.length:0,f=0;f<e;f++)c.push(d[f].replace("<","").replace(">",""));var g={option:a.split(" ")[0],description:b,params:c};return g}),this.description=b,this.action=c};return a})}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Commands.Parameter").factory("ChromaOSTerminalParameter",["ChromaOSTerminalBaseParameter",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=new a,b}])}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Commands",["ChromaOSTerminal.Modules.Commands.Command","ChromaOSTerminal.Modules.Commands.Parameter"])}(window.angular),function(a){"use strict";a.module("ChromaOSTerminal.Modules.Terminal",[])}(window.angular),function(a){"use strict";function b(a,b,c,d){function e(b,c,d){c.addClass("chromaos-terminal-wrapper"),b.tId||(b.tId=Math.floor(9e4*Math.random())+1e4),c.addClass("chromaos-terminal-"+b.tId),c.find(".chromaos-terminal").attr("data-terminal-id",b.tId),d.$init(c.find(".chromaos-terminal"),b.commands),a.$on("chromaos-terminal.username.set",function(a,c){c.tId===b.tId&&d.$changeUsername(c.username)}),a.$on("chromaos-terminal.glue.set",function(a,c){c.tId===b.tId&&d.$changeGlue(c.glue)}),a.$on("chromaos-terminal.environment.set",function(a,c){c.tId===b.tId&&d.$changeEnvironment(c.environment)}),a.$on("chromaos-terminal.input.set",function(a,c){c.tId===b.tId&&d.$changeInput(c.input)}),a.$on("chromaos-terminal.username.reset",function(a,c){c.tId===b.tId&&d.$resetUsername()}),a.$on("chromaos-terminal.glue.reset",function(a,c){c.tId===b.tId&&d.$resetGlue()}),a.$on("chromaos-terminal.environment.reset",function(a,c){c.tId===b.tId&&d.$resetEnvironment()}),a.$on("chromaos-terminal.input.reset",function(a,c){c.tId===b.tId&&d.$resetInput()}),a.$on("chromaos-terminal.all.reset",function(a,c){c.tId===b.tId&&d.$resetAll()})}var f={restrict:"EA",scope:{commands:"=",tId:"="},templateUrl:"modules/chromaos-terminal/directives/views/ChromaOSTerminalDirectiveTemplate.html",compile:function(a,b){return{post:function(a,b,c,d){e(a,b,d)}}},controller:"ChromaOSTerminalDirectiveController"};return f}a.module("ChromaOSTerminal.Modules.Terminal").directive("chromaosTerminal",b),b.$inject=["$rootScope","ChromaOSTerminalCommand","ChromaOSTerminalParameter","$timeout"]}(window.angular),function(a){"use strict";function b(b,c,d,e,f,g,h){function i(a){a.stopPropagation(),a.preventDefault();var c=a.clipboardData.getData("Text");b.paste(c,A)}var j,k,l,m="chromaos",n=m,o="@",p=o,q="terminal",r=q,s=">",t=s,u="chromaos-terminal-line",v="chromaos-terminal-line-__id__",w="chromaos-terminal-cursor",x="chromaos-terminal-character",y="chromaos-terminal-character-unerasable",z=0,A=!1,B="",C=[],D=0;b.getPrompt=function(){return n+p+r+t},b.getCharacter=function(b,c){var d=a.element("<div></div>").addClass(x).html(b);return c&&d.addClass(y),d},b.getCursor=function(){return a.element("<div></div>").addClass(w)},b.removeCursor=function(){a.element("."+w).remove()},b.addLine=function(){var b=a.element("<div></div>").addClass(u).addClass(v.replace("__id__",z));return z++,k.append(b),b},b.emptyLine=function(a){return a.find("."+x+":not(."+y+")").remove(),a},b.placeCursor=function(a){a.append(b.getCursor())},b.write=function(a,c,d){" "===c&&(c="&nbsp"),a.append(b.getCharacter(c,d))},b.writeText=function(a,c,d){for(var e=0;e<c.length;e++)b.write(a,c[e],d)},b.backspace=function(a){b.removeCursor();var c=a.find("."+x+":last-child");c.hasClass(y)||(c.remove(),B=B.slice(0,-1)),b.placeCursor(A)},b.parseInput=function(a){var b=d.defer();return f.parse(j,a).then(function(a){b.resolve(a)}),b.promise},b.enter=function(){var c=d.defer(),e=a.copy(B);return b.parseInput(e).then(function(a){c.resolve(a)}),B="",c.promise};var E=function(){a.element(k).scrollTop(a.element(k)[0].scrollHeight)};b.writePrompt=function(a){var c=b.getPrompt();b.writeText(a,c,!0),E()},b.paste=function(a,c){b.removeCursor(),B+=a,b.writeText(c,a,!1),E(),b.placeCursor(A)},b.makeWritable=function(c){a.element(document).unbind("keypress"),a.element(document).unbind("keydown"),document.removeEventListener("paste",i),c&&(document.addEventListener("paste",i),a.element(document).on("keydown",function(a){switch(a.which){case 8:b.backspace(A);break;case 38:a.preventDefault(),D>0&&(D--,b.removeCursor(),b.emptyLine(A),b.writeText(A,C[D]),B=C[D],b.placeCursor(A));break;case 40:a.preventDefault(),D<C.length-1?(D++,b.removeCursor(),b.emptyLine(A),b.writeText(A,C[D]),B=C[D],b.placeCursor(A)):(b.removeCursor(),b.emptyLine(A),b.writeText(A,""),b.placeCursor(A))}}),a.element(document).on("keypress",function(a){var c;switch(a.which){case 13:b.removeCursor(),C.push(B),D++,b.enter().then(function(a){if(a.length>0){var d=0;do c=b.addLine(),A=c,b.writeText(A,a[d],!0),d++;while(d<a.length)}c=b.addLine(),b.writePrompt(c),b.write(c,"",!0),b.placeCursor(c),A=c});break;default:B+=String.fromCharCode(a.which),A&&(b.removeCursor(),b.write(A,String.fromCharCode(a.which)),b.placeCursor(A))}}))};var F=function(){j.push(new g("Clear","Clear command","clear",function(b){var c=d.defer();return a.element('.chromaos-terminal[data-terminal-id="'+k.attr("data-terminal-id")+'"]').find("."+u).remove(),c.resolve(!0),c.promise})),j.push(new g("Exit","Exit command","exit",function(a){var c=d.defer();return b.$emit("chromaos-terminal.exit",{}),c.resolve(!0),c.promise}));var c,e;j.push(new g("Help","Help command","help",function(a,b){var f=d.defer();return j.map(function(a){b.push(a.command+": "+a.description),a.parameters.map(function(a){c=[],a.options.map(function(a){e=(a.option.length>1?"-":"")+"-"+a.option,a.params.length>0&&a.params.map(function(a){e+=" <"+a+">"}),c.push(e)}),b.push(c.join(", ")+": "+a.description)}),b.push(" ")}),f.resolve(b),f.promise}));var f=new g("History","History command","history",function(b,c){var e=d.defer(),f=a.copy(C);f.pop();var g,h,i=Math.min(f.length,50);b.all&&(b.m||b.max)?e.resolve({result:!1,error:"You can't use --all and (-m or --max)."}):b.all?i=f.length:(b.m||b.max)&&(i=b.maxHistory);for(var j=0;j<i;j++)g=f[j],h=j+1,c.push(h+" "+g);return e.resolve(c),e.promise});f.addParameter(new h(["all"],"Shows all history.")),f.addParameter(new h(["m <max-history>","max <max-history>"],"Shows <max-history> history's entries.")),j.push(f)};this.$init=function(d,f){k=d,j=a.copy(f),F();var g=b.addLine();b.writePrompt(g),b.write(g,"",!0),A=g,e(function(){a.element('.chromaos-terminal[data-terminal-id="'+k.attr("data-terminal-id")+'"]').on("click",function(a){a.stopPropagation(),l||(c.$broadcast("chromaos-terminal.focus.in",{tId:k.attr("data-terminal-id")}),b.placeCursor(A),b.makeWritable(!0),l=!0)})},0),c.$on("chromaos-terminal.focus.in",function(a,c){c.tId!==k.attr("data-terminal-id")&&(b.removeCursor(),b.makeWritable(!1),l=!1)})},this.$changeUsername=function(a){n=a},this.$changeGlue=function(a){p=a},this.$changeEnvironment=function(a){r=a},this.$changeInput=function(a){t=a},this.$resetUsername=function(){n=m},this.$resetGlue=function(){p=o},this.$resetEnvironment=function(){r=q},this.$resetInput=function(){t=s},this.$resetAll=function(){this.$resetUsername(),this.$resetGlue(),this.$resetEnvironment(),this.$resetInput()}}a.module("ChromaOSTerminal.Modules.Terminal").controller("ChromaOSTerminalDirectiveController",b),b.$inject=["$scope","$rootScope","$q","$timeout","ChromaOSTerminalCommandsService","ChromaOSTerminalCommand","ChromaOSTerminalParameter"]}(window.angular),angular.module("ChromaOSTerminal.Templates",["modules/chromaos-terminal/directives/views/ChromaOSTerminalDirectiveTemplate.html"]),angular.module("modules/chromaos-terminal/directives/views/ChromaOSTerminalDirectiveTemplate.html",[]).run(["$templateCache",function(a){a.put("modules/chromaos-terminal/directives/views/ChromaOSTerminalDirectiveTemplate.html",'<div class="chromaos-terminal">\n\t\n</div>\n')}]),function(a){"use strict";a.module("ChromaOSTerminal",["ChromaOSTerminal.Kernel","ChromaOSTerminal.Templates","ChromaOSTerminal.Modules","ChromaOSTerminal.Services"])}(window.angular);